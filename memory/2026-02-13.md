# 2026-02-13

## OneDrive Memories Extraction - Fixed and Documented

**Issue:** I was struggling to extract OneDrive memory photos from emails. The old method from Feb 9-10 wasn't working for today's email.

**Root cause:** I was looking for the wrong patterns and not properly decoding the HTML body.

**Working method (documented in rules/inbox_zero.md):**
1. Get email JSON via `gog gmail thread get <id> --json`
2. Extract HTML part: `jq -r '.thread.messages[0].payload.parts[] | select(.mimeType == "text/html") | .body.data'`
3. Decode URL-safe base64: `tr '_-' '/+' | base64 -d`
4. Find photo URLs: `grep -oP 'https://my\.microsoftpersonalcontent\.com/[^"<>\s]+'`
5. Download with User-Agent header: `curl -sL "$url" -H "User-Agent: Mozilla/5.0" -o file.jpg`

**Key learnings:**
- The photos ARE embedded in the email HTML as thumbnail URLs with tempauth tokens
- Must decode HTML body first (not just search raw JSON)
- Must include User-Agent header in curl or downloads fail
- Tokens are valid for ~30 days
- Always show images FIRST, then present summary with action buttons
- On delete: trash email, delete button message, rm local files

**Result:** Successfully extracted and displayed 5 family photos from February 13 memories.

## Inbox Zero Workflow - Continuous Improvement

**User feedback:** "Show the images, always" - I should ALWAYS extract and display attachments/images for certain email types (USPS mail, OneDrive memories) without waiting for user to request them.

**Updated behavior:** For emails with image attachments or embedded photos, download and send them immediately along with the summary.
